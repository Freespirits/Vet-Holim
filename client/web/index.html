<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="description" content="Vet Holim tablet web client" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="data:," />
    <meta name="theme-color" content="#1976d2" />
    <title>Vet Holim</title>
    <script src="flutter.js" defer></script>
    <script src="main.dart.js" defer></script>
  </head>
  <body>
    <main id="flutter-fallback" data-test="flutter-fallback" hidden>
      <h1>הבנייה של Flutter אינה זמינה</h1>
      <p>
        יש להריץ <code>flutter build web</code> ולפרוס את הקבצים (כולל flutter.js ו-main.dart.js)
        בתוך <code>client/web</code>. פעולה זו מונעת מסך לבן ומבטיחה שהאפליקציה תיטען כראוי.
      </p>
      <p data-fallback-reason aria-live="polite"></p>
    </main>
    <script>
      function showFallback(reason) {
        const fallback = document.getElementById('flutter-fallback');
        if (!fallback) {
          return;
        }
        const reasonTarget = fallback.querySelector('[data-fallback-reason]');
        if (reasonTarget) {
          reasonTarget.textContent = reason;
        }
        fallback.hidden = false;
      }

      function startFlutter() {
        const loader = window._flutter?.loader;
        const mainBundle = document.querySelector('script[src$="main.dart.js"]');
        if (!loader) {
          showFallback(
            'לא נמצא flutter.js. ודאו שהרצתם "flutter build web" כדי להפיק את משאבי הווב.'
          );
          return;
        }
        if (!mainBundle) {
          showFallback('לא נמצא main.dart.js. ודאו שהבנייה נפרסה בתוך client/web.');
          return;
        }

        loader
          .loadEntrypoint({ serviceWorker: { serviceWorkerVersion: null } })
          .then((engineInitializer) => engineInitializer.initializeEngine())
          .then((appRunner) => appRunner.runApp())
          .catch((error) => {
            const details = error instanceof Error ? error.message : String(error ?? '');
            showFallback('טעינת Flutter נכשלה: ' + details);
          });
      }

      window.addEventListener('load', startFlutter);
    </script>
  </body>
</html>
